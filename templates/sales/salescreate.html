{% extends 'admintemplates/adminbase.html' %}
{% load static %}
{% block content %}
<style>
    .item-row th {
        background: #eee;
    }

    .delete-btn {
        position: relative;
    }

    .delete {
        display: block;
        color: #000;
        text-decoration: none;
        position: absolute;
        background: #EEEEEE;
        font-weight: bold;
        padding: 0px 3px;
        border: 1px solid;
        top: -6px;
        left: -6px;
        font-family: Verdana;
        font-size: 12px;
    }
    #price{
        font-size: 12px;
    }
</style>
<script>
		function addRow(tableID) {

            var table = document.getElementById(tableID);

            var rowCount = table.rows.length;
            var row = table.insertRow(rowCount);

            var colCount = table.rows[0].cells.length;

            for(var i=0; i<colCount; i++) {

                var newcell	= row.insertCell(i);

                newcell.innerHTML = table.rows[0].cells[i].innerHTML;
                //alert(newcell.childNodes);
                switch(newcell.childNodes[0].type) {
                    case "text":
                            newcell.childNodes[0].value = "";
                            break;
                    case "checkbox":
                            newcell.childNodes[0].checked = false;
                            break;
                    case "select-one":
                            newcell.childNodes[0].selectedIndex = 0;
                            break;
                }
            }
            }

        function deleteRow(tableID) {
            try {
            var table = document.getElementById(tableID);
            var rowCount = table.rows.length;

            for(var i=0; i<rowCount; i++) {
                var row = table.rows[i];
                var chkbox = row.cells[0].childNodes[0];
                if(null != chkbox && true == chkbox.checked) {
                    if(rowCount <= 1) {
                        alert("Cannot delete all the rows.");
                        break;
                    }
                    table.deleteRow(i);
                    rowCount--;
                    i--;
                }


            }
            }catch(e) {
                alert(e);
            }
            }
</script>


<div class="col-lg-12 col-md-12 col-sm-12">
    <div class="content-panel" style="padding: 5px">
        <div class="row" style="font-size: 15px;">
            <div class="col-xs-12 col-md-12">
                <h2 style="text-align: center;">myBill</h2>
                <hr>
                <div class="row">
                    <div class="col-xs-6 col-md-6">
                        <div class="existing-customer">
                            <span class="customererror" style="color: red; display: none">Customer Doesn't exist please add Customer</span>
                            <input class="form-control customer" id="customer-id" placeholder="Customer" list="customer-list" >
                            <form action="post">
                                <datalist id="customer-list">
                                    <!-- {% for sale in sales %}   -->
                                        {% for customer in sales.customer.all %}                                  
                                             <option data-id="{{ customer.id }}">{{ customer.customer }}</option>
                                        {% endfor %}     
                                    <!-- {% endfor %} -->
                                </datalist>
                            </form><br>
                            <br>
                        </div>
                        <div id="new-customer-form" class="new-customer-form" style="display: none">
                            <span class="already-error" style="color: red; display: none">This Customer Already exist</span>
                            <input type="text" class="form-control customer_name" name="customer_name" placeholder="Customer Name"><br>
                            <input type="number" class="form-control customer_phone" name="customer_phone" placeholder="Customer Phone"><br>
                            <a class="added-customer" style="cursor: pointer;">Existing Customer</a><br><br>
                        </div>

                        <div class="table-responsive">
                            <table class="table table-bordered">
                                <thead>
                                <tbody>
                                <tr hidden>
                                    <td></td>
                                    <td></td>
                                    <td class="text-right"><strong>Sub Total</strong></td>
                                    <td><span id="subtotal">0.00</span></td>
                                </tr>
                                <tr hidden>
                                    <td></td>
                                    <td></td>
                                    <td class="text-right"><strong>Discount</strong></td>
                                    <td><input class="form-control" id="discount" value="0" type="text"></td>
                                </tr>
                                <tr hidden>
                                    <td></td>
                                    <td></td>
                                    <td class="text-right"><strong>Shipping</strong></td>
                                    <td><input class="form-control" id="shipping" value="0" type="text"></td>
                                </tr>
                                <tr>
                                    <td><strong>Total Qty: </strong><span id="totalQty" style="color: red; font-weight: bold">0</span></td>
                                    <td></td>
                                    <td class="text-right"><strong>Grand Total</strong></td>
                                    <td><span id="grandTotal" style="color:red">0</span></td>
                                </tr>
                                <tr>
                                    <td colspan="4"></td>
                                </tr>
                                <tr>
                                    <td></td>
                                    <td></td>
                                    <td class="text-right"><strong>Received Amount</strong></td>
                                    <td><input class="form-control" id="paidAmount" value="0" type="text"></td>
                                </tr>
                                <tr>
                                    <td></td>
                                    <td></td>
                                    <td class="text-right"><strong>Remaining Amount</strong></td>
                                    <td><span id="remainingAmount">0</span></td>
                                </tr>
                                <tr>
                                    <td colspan="4"></td>
                                </tr>
                                <tr>
                                    <td></td>
                                    <td></td>
                                    <td class="text-right"><strong>Cash Payment</strong></td>
                                    <td><input class="form-control" id="cash_payment" value="0" type="text"></td>
                                </tr>
                                <tr>
                                    <td></td>
                                    <td></td>
                                    <td class="text-right"><strong>Returned Cash</strong></td>
                                    <td><span id="returned_cash">0</span></td>
                                </tr>
                                </tbody>
                            </table>
                        </div>
                        <div class="col-md-12">
                            <a style="width: 100%; font-size: large" id="create-invoice" href="javascript:;" title="Create Invoice" class="btn btn-primary pull-right" id="load" data-loading-text="<i class='fa fa-circle-o-notch fa-spin'></i>Processing Order">Create Invoice</a>
                        </div>
                    </div>
                    <div class="col-xs-6 col-md-6">
                        <form method="post">
                            {% csrf_token %}
                            <div id="item-data-sc" class="table-responsive item-data-sc" style="height: 500px; overflow: scroll;">
                                <table  class="table table-bordered">
                                    <INPUT type="button" value="Add Row" onclick="addRow('dataTable')" />
                                    <INPUT type="button" value="Delete Row" onclick="deleteRow('dataTable')" />                               
                                    <thead>
                                        <tr class="item-row">
                                            <th>action</th>
                                            <th>Item</th>
                                            <th>Supplier</th>
                                            <th>Price</th>
                                            <th>Unit_type</th>
                                            <th>Total</th>
                                        </tr>
                                    </thead>
                                    
                                    <tbody id="dataTable" width="100%" border="1">
                                                    <TR>
                                                        <TD><INPUT type="checkbox" name="chk"/></TD>
                                                        <TD>
                                                            <SELECT name="product">
                                                                {% for product in sales %}
                                                                    <option data-id="{{ product.id }}">{{ product.name }}</option>
                                                                {% endfor %}
                                                                
                                                            </SELECT>

                                                        </TD>
                                                            <td>mykirana</td>
                                                            <td class="price">{{ form.price }}</td>
                                                            <td>{{ form.unit_type }}</td>
                                                            <td>{{ form.total }}</td>
                                                            



                                                            
                                                        
                        
                                                    </TR>
                                
                                    </tbody>
                                
                            </div>
                        
                        </form>
                    </div>    
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

<!-- TODO:establish a relation bewtee customer and saleshistory using set-all  -->
